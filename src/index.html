<!doctype html>
<html lang="en">

    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    
        <style>
            .nav-link{
                border: solid 2px;
                border-radius: 10px;
            }
        </style>
    
    
    </head>

    <body>


        <header>
            <div class="navbar navbar-dark bg-dark shadow-sm">
                <div class="container">
                    <a href="#" class="navbar-brand d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" 
                            width="20" 
                            height="20" 
                            fill="none" 
                            stroke="currentColor" 
                            stroke-linecap="round" 
                            stroke-linejoin="round" 
                            stroke-width="2" 
                            aria-hidden="true" 
                            class="me-2" 
                            viewBox="0 0 24 24">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/>
                        </svg>
                        <strong>encrypt.transfer.repeat</strong>
                    </a>
                    <button 
                        class="navbar-toggler" 
                        type="button" 
                        data-bs-toggle="collapse" 
                        data-bs-target="#navbarHeader" 
                        aria-controls="navbarHeader" 
                        aria-expanded="false" 
                        aria-label="Toggle navigation">
                        
                    </button>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT OF THE PAGE -->
        <main>


            <!-- TABS SECTION -->
            <section class="py-5 container">
                

                <div class="row">
                
                    <!-- NAV COLUMN -->
                    <div class="col-md-2 text-center ">
                        <ul class="nav flex-column" id="myTab" role="tablist">
                        
                          <li class="nav-item py-2" role="presentation">
                            <a role="button"
                                class="nav-link active" 
                                id="home-tab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#home" 
                                role="tab" 
                                aria-controls="home" 
                                aria-selected="true">Home</a>
                          </li>
                        
                          <li class="nav-item py-2" role="presentation">
                            <a role="button"
                                class="nav-link" 
                                id="genkeys-tab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#genkeys" 
                                role="tab" 
                                aria-controls="genkeys" 
                                aria-selected="false">Generate Keys</a>
                          </li>
                          
                          <li class="nav-item py-2" role="presentation">
                            <a role="button"
                                class="nav-link" 
                                id="encrypt-tab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#encrypt" 
                                role="tab" 
                                aria-controls="encrypt" 
                                aria-selected="false">Encrypt</a>
                          </li>
                          
                          <li class="nav-item py-2" role="presentation">
                            <a role="button"
                                class="nav-link" 
                                id="decrypt-tab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#decrypt" 
                                role="tab" 
                                aria-controls="decrypt" 
                                aria-selected="false">Decrypt</a>
                          </li>
						  
                          <li class="nav-item py-2" role="presentation">
                            <a role="button"
                                class="nav-link" 
                                id="trx-tab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#trx" 
                                role="tab" 
                                aria-controls="trx" 
                                aria-selected="false">Transfer</a>
                          </li>
						  
                          <li class="nav-item py-2" role="presentation">
                            <a role="button"
                                class="nav-link" 
                                id="keyri-tab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#keyri" 
                                role="tab" 
                                aria-controls="keyri" 
                                aria-selected="false">KeyRi - Unchained</a>
                          </li>
                          
                        </ul>
                    </div>
                    <!-- /// /// /// NAV COLUMN -->
                    
                    <!-- NAV CONTENT -->
                    <div class="tab-content col-md-10">
                    
                        <!-- HOME TAB -->
                        <div class="tab-pane fade show active text-center " id="home" role="tabpanel" aria-labelledby="home-tab">
                            <div class="row py-lg-5">
                                <div class="col-lg-6 col-md-8 mx-auto">
                                    <h1 class="fw-light">Encrypt. Transfer. Repeat.</h1>
                                    <p class="lead text-muted">Securely Encrypt and Transfer documents <strong>WITHOUT</strong> touching a Third-Party-Server.</p>
                                </div>
                            </div>
                        </div>

                        <!-- KEY GEN TAB -->
                        <div class="tab-pane fade show text-center " id="genkeys" role="tabpanel" aria-labelledby="genkeys-tab">
                            <div class="row py-lg-5">
                                <div class="col-lg-6 col-md-8 mx-auto">
                                    <h1 class="fw-light">Key Generation</h1>
                                    <p class="lead text-muted">Click Below to generate an RSA Key Pair...</p>
                                    <a onclick="EzCrypto.createKeys()" class="btn btn-large" role="button">GENERATE</a>
                                </div>
                            </div>
                        </div>

                        <!-- ENCRYPTION TAB -->
                        <div class="tab-pane fade" id="encrypt" role="tabpanel" aria-labelledby="encrypt-tab">
                            <div class="row py-lg-3 text-center ">
                                <div class="col-lg-6 col-md-8 mx-auto">
                                    <h1 class="fw-light">Data Encryption</h1>
                                    <p class="lead text-muted">Provide your *PUBLIC KEY* and the *FILE* you want to encrypt.</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6 col-md-8 mx-auto pt-lg-5 pb-lg-3" >
                                    <form>
                                        <div class="mb-3">
                                            <label for="publickey" class="form-label">Public Key</label>
                                            <input type="file" class="form-control" id="publickey" aria-describedby="publickeyHelp">
                                            <div id="publickeyHelp" class="form-text">Your Public Key Goes Here</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="rawfile" class="form-label">Your File</label>
                                            <input type="file" class="form-control" id="rawfile">
                                            <div id="rawfileHelp" class="form-text">This is What You're Encrypting</div>
                                        </div>
                                        
                                        <a onclick="encrypt()" class="btn btn-primary">Encrypt</a>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        
                        <!-- DE-CRYPTION TAB -->
                        <div class="tab-pane fade" id="decrypt" role="tabpanel" aria-labelledby="decrypt-tab">
                            <div class="row py-lg-3 text-center ">
                                <div class="col-lg-6 col-md-8 mx-auto">
                                    <h1 class="fw-light">DATA DECRYPTION</h1>
                                    <p class="lead text-muted">Provide your *PRIVATE KEY*, the *ENCRYPTED FILE KEY*, and the *ENCRYPTED FILE*.</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6 col-md-8 mx-auto pt-lg-5 pb-lg-3" >
                                    <form>
                                        <div class="mb-3">
                                            <label for="privatekey" class="form-label">Private Key</label>
                                            <input type="file" class="form-control" id="privatekey" aria-describedby="publickeyHelp">
                                            <div id="privatekeyHelp" class="form-text">Your PRIVATE Key Goes Here</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="filekey" class="form-label">File Key</label>
                                            <input type="file" class="form-control" id="filekey" aria-describedby="filekeyHelp">
                                            <div id="filekeyHelp" class="form-text">Your FILE Key Goes Here</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="encryptedfile" class="form-label">Encrypted File</label>
                                            <input type="file" class="form-control" id="encryptedfile">
                                            <div id="encryptedfileHelp" class="form-text">This is What You're DECRYPTING</div>
                                        </div>
                                        
                                        <a onclick="decrypt()" class="btn btn-primary">DECRYPT</a>
                                    </form>
                                </div>
                            </div>
                        </div>
						
						
						
						
                        
                        <!-- FILE TRANSFER TAB -->
                        <div class="tab-pane fade" id="trx" role="tabpanel" aria-labelledby="trx-tab">
                            <div class="row py-lg-3 text-center ">
                                <div class="col-lg-6 col-md-8 mx-auto">
                                    <h1 class="fw-light">FILE TRANSFER</h1>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6 col-md-8 mx-auto pt-lg-5 pb-lg-3" >
                                    <form>
                                        <div class="mb-3">
                                            <label for="trx-file" class="form-label">Transfer File</label>
                                            <input type="file" class="form-control" id="trx-file" aria-describedby="publickeyHelp">
                                            <div id="privatekeyHelp" class="form-text">This is the file you're shipping</div>
                                        </div>
                                        
                                        <a onclick="transfer()" class="btn btn-primary">TRANSFER</a>
                                    </form>
                                </div>
                            </div>
                        </div>
						
                        <!-- KEY RI TAB -->
                        <div class="tab-pane fade show text-center " id="keyri" role="tabpanel" aria-labelledby="keyri-tab">
                            <div class="row py-lg-5">
                                <div class="col-lg-6 col-md-8 mx-auto">
                                    <h1 class="fw-light">KeyRi - UNCHAINED</h1>
                                    <p class="lead text-muted">Click Below to test shit</p>
                                    <a onclick="workBitch()" class="btn btn-large btn-primary" role="button">GENERATE</a>
                                </div>
                            </div>
                        </div>
						
                    </div>
                </div>
                <!-- /// /// /// NAV CONTENT -->
            </section>
        </main>
    </body>
</html>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
<script src="./output.big.js"></script>
<script>
    
    // ********************************
    // UTITLITY TO READ FILE AS A PROMISE
    // ********************************
    function readFile(file, type = "buffer"){
        return new Promise((res, rej) => {
            const fr = new FileReader();
            fr.onerror = rej;
            
            fr.onloadend = function() {
                console.log("LOAD END");
                console.log(fr);
                res(fr.result);
            }
            
            
            if(type == "text"){
                fr.readAsText(file);
            } else if(type == "binary"){
                fr.readAsBinaryString(file);
            } else if(type == "buffer"){
                fr.readAsArrayBuffer(file)
            }
        });
    }

    // ********************************
    // ENCRYPT SCRIPT
    // ********************************
    function encrypt(){

        var file_pk = document.querySelector("#publickey").files["0"];

        var file_raw = document.querySelector("#rawfile").files["0"];
        
        var obj = {};

        readFile(file_pk)
            .then((pk) => {
                obj.pk = pk;
                return readFile(file_raw);
            })
            .then((raw) => {
                EzCrypto.encrypt(raw, obj.pk, file_raw.name);
            })
    }
    
    
    // ********************************
    // DECRYPT SCRIPT
    // ********************************
    function decrypt(){

        var file_pk = document.querySelector("#privatekey").files["0"];

        var file_filekey = document.querySelector("#filekey").files["0"];
        
        var file_encrypted = document.querySelector("#encryptedfile").files["0"];
        
        var obj = {};

        readFile(file_pk)
            // Load the private Key
            .then((pk) => {
                obj.pk = pk;
                return readFile(file_filekey);
            })
            // Load the file key
            .then((fk) => {
                obj.fk = fk;
                return readFile(file_encrypted);
            })
            // Load the encrypted file
            .then((crypt) => {
            
                EzCrypto.decrypt(obj.pk, obj.fk, crypt, file_encrypted.name);
            })
    }
    
    // ********************************
    // TRANSFER SCRIPT
    // ********************************
    function transfer(){
		readFile(document.querySelector("#trx-file").files[0]).then((d) => {
			wh.chat(d);
		})
	}
	
	
	// PROOF OF CONCEPT --- WORK BITCH!
	function workBitch(){
			
		alert(":CLICKED");
			
		var wams = new WebAuthMServer();
		var wam = new WebAuthM();

		wams.get__AssertionOptions("justin@wolcott.io","justin wolcott",btoa("ASSHOLE"))
			.then((publicKey) => {
				console.log("01 - START => ", publicKey);
				return wam.makeCredential(publicKey)
			})
			.then((clientOut) => {
				console.log("02 - Client Out => ",clientOut, JSON.parse(clientOut.data))
				return wams.post__MakeCredential(clientOut);
			})
			.then((data) => {
				console.log("03 - ??? => ", data)
				return wams.get__ExistingAssertionOptions("justin@wolcott.io","justin wolcott",btoa("ASSHOLE"));
			})
			.then((data) => {
				console.log("04 - ??? => ",data);
				that =  wam.getCredential(data);

				return navigator.credentials.get(that);
			})
			.then((creds) => {
				console.log("CREDS",creds)
			})

			.catch((e) => {
				console.error(e)
				alert(e);
			})
	
	}

</script>